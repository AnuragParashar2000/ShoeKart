import{r as d,j as e,T as b,f as o,A as m}from"./index-eab7dac9.js";import{C as N}from"./CustomerTable-6fc825d1.js";const A=()=>{const[p,h]=d.useState([]),[f,u]=d.useState(!0),c=async()=>{var t,r;try{console.log("fetching coupons");const n=localStorage.getItem("jwtAdmin");if(!n)return o.error("Access denied. Please login first.");const a=await m.get("/admin/coupons",{headers:{Authorization:n}});console.log(a.data),a.data.success&&h(a.data.data),u(!1)}catch(n){o.error((r=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:r.message),u(!1)}};d.useEffect(()=>{c()},[]);const x=[{Header:"Name",accessor:"id"},{Header:"Discount",accessor:"percent_off"},{Header:"Duration",accessor:"duration"},{Header:"Redemption Left",accessor:"redemption_left"}],[s,l]=d.useState({name:"",discount:"",duration:"forever",duration_in_months:"",max_redemptions:""}),g=t=>{l({...s,name:t.id,discount:t.percent_off,duration:t.duration!=="forever"?"repeating":"forever",duration_in_months:t.duration_in_months||12,max_redemptions:t.max_redemptions})},i=t=>{l({...s,[t.target.id]:t.target.value.trim()})},j=async t=>{var r,n;t.preventDefault();try{if(!s.name||!s.discount||!s.duration||!s.max_redemptions)return o.error("Please fill all the fields.");const a=localStorage.getItem("jwtAdmin");if(!a)return o.error("Access denied.");const _=await m.post("/admin/coupons",{formData:s},{headers:{Authorization:a}});o.success(_.data.message),c()}catch(a){o.error((n=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:n.message)}},v=async()=>{var t,r;try{if(!s.name)return o.error("Please select a coupon to delete.");if(s.name==="SUMILSUTHAR197")return o.error("You can't delete this coupon.");const n=localStorage.getItem("jwtAdmin");if(!n)return o.error("Access denied.");const a=await m.delete(`/admin/coupons/${s.name.toUpperCase()}`,{headers:{Authorization:n}});o.success(a.data.message),l({name:"",discount:"",duration:"",duration_in_months:"",max_redemptions:""}),c()}catch(n){o.error((r=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:r.message)}};return f?e.jsx(b,{height:"500px"}):e.jsxs("div",{className:"dashboardMain",children:[e.jsx("h1",{children:"Coupons"}),e.jsx("div",{className:"dashOverview dash-forms",children:e.jsxs("form",{onSubmit:j,children:[e.jsxs("div",{className:"inputs",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Name"}),e.jsx("input",{type:"text",className:"form-control",id:"name",placeholder:"Enter coupon name",style:{textTransform:"uppercase"},onChange:i,value:s.name})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"discount",children:"Discount"}),e.jsx("input",{type:"number",className:"form-control",id:"discount",min:"0",max:"100",placeholder:"Enter discount in percentage",onChange:i,value:s.discount})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"duration",children:"Coupon Type"}),e.jsxs("select",{className:"form-control",id:"duration",onChange:i,value:s.duration,children:[e.jsx("option",{value:"forever",children:"Forever"}),e.jsx("option",{value:"repeating",children:"Repeating"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"duration_in_months",children:"Duration"}),e.jsx("input",{type:"number",className:"form-control",id:"duration_in_months",min:"0",max:"12",placeholder:"valid for how many months?",disabled:s.duration==="forever",onChange:i,value:s.duration_in_months})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"max_redemptions",children:"Max Redemptions"}),e.jsx("input",{min:0,type:"number",className:"form-control",id:"max_redemptions",placeholder:"Enter 999 for unlimited redemptions",onChange:i,value:s.max_redemptions})]})]}),e.jsxs("div",{className:"inputs-btn",children:[e.jsx("button",{type:"button",onClick:v,children:"Delete"}),e.jsx("button",{type:"submit",children:"Add"})]})]})}),e.jsx("div",{className:"dashOverview",style:{overflow:"auto"},children:e.jsx(N,{columns:x,data:p,handleChange:g})})]})};export{A as default};
